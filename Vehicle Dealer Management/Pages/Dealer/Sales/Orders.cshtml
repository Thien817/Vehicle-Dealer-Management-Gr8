@page
@model Vehicle_Dealer_Management.Pages.Dealer.Sales.OrdersModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω ƒë∆°n h√†ng";
    // UserRole and UserName are set in code-behind from Session
}

@await Html.PartialAsync("_PageHeader")

<div class="content-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="content-title">Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
            <p class="content-subtitle">Theo d√µi v√† x·ª≠ l√Ω ƒë∆°n h√†ng</p>
        </div>
        <a href="/Dealer/Sales/CreateQuote" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> T·∫°o ƒë∆°n m·ªõi
        </a>
    </div>
</div>

<!-- Stats -->
<div class="grid grid-cols-4 mb-4">
    <div class="stat-card">
        <div class="stat-label">T·ªïng ƒë∆°n h√†ng</div>
        <div class="stat-value">@Model.TotalOrders</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ƒêang m·ªü</div>
        <div class="stat-value" style="color: var(--warning);">@Model.OpenOrders</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ƒê√£ thanh to√°n</div>
        <div class="stat-value" style="color: var(--success);">@Model.PaidOrders</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">ƒê√£ giao</div>
        <div class="stat-value" style="color: var(--info);">@Model.DeliveredOrders</div>
    </div>
</div>

<!-- Status Tabs -->
<div class="card mb-4">
    <div class="card-body" style="padding: 0;">
        <div style="display: flex; border-bottom: 1px solid var(--border); flex-wrap: wrap;">
            <a href="?status=all" class="tab-btn @(Model.StatusFilter == "all" ? "active" : "")" style="padding: 1rem 1.5rem; text-decoration: none; color: inherit; border-bottom: 2px solid @(Model.StatusFilter == "all" ? "var(--accent-cyan)" : "transparent");">
                T·∫•t c·∫£
            </a>
            <a href="?status=OPEN" class="tab-btn @(Model.StatusFilter == "OPEN" ? "active" : "")" style="padding: 1rem 1.5rem; text-decoration: none; color: inherit; border-bottom: 2px solid @(Model.StatusFilter == "OPEN" ? "var(--accent-cyan)" : "transparent");">
                ƒêang m·ªü
            </a>
            <a href="?status=PAID" class="tab-btn @(Model.StatusFilter == "PAID" ? "active" : "")" style="padding: 1rem 1.5rem; text-decoration: none; color: inherit; border-bottom: 2px solid @(Model.StatusFilter == "PAID" ? "var(--accent-cyan)" : "transparent");">
                ƒê√£ thanh to√°n
            </a>
            <a href="?status=DELIVERED" class="tab-btn @(Model.StatusFilter == "DELIVERED" ? "active" : "")" style="padding: 1rem 1.5rem; text-decoration: none; color: inherit; border-bottom: 2px solid @(Model.StatusFilter == "DELIVERED" ? "var(--accent-cyan)" : "transparent");">
                ƒê√£ giao
            </a>
        </div>
    </div>
</div>

<!-- Orders Table -->
<div class="card">
    <div class="card-body">
        @if (Model.Orders.Any())
        {
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>M√£ ƒë∆°n</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>Ng√†y t·∫°o</th>
                            <th>S·ªë xe</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>ƒê√£ tr·∫£</th>
                            <th>C√≤n l·∫°i</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.Orders)
                        {
                            <tr>
                                <td><strong>#@order.Id</strong></td>
                                <td>
                                    <div><strong>@order.CustomerName</strong></div>
                                    <div class="text-muted" style="font-size: 0.875rem;">@order.CustomerPhone</div>
                                </td>
                                <td>@order.CreatedAt.ToString("dd/MM/yyyy")</td>
                                <td>@order.VehicleCount xe</td>
                                <td><strong>@order.TotalAmount.ToString("N0") VND</strong></td>
                                <td style="color: var(--success);">@order.PaidAmount.ToString("N0")</td>
                                <td>
                                    @if (order.RemainingAmount > 0)
                                    {
                                        <strong style="color: var(--error);">@order.RemainingAmount.ToString("N0")</strong>
                                    }
                                    else
                                    {
                                        <span class="text-muted">0</span>
                                    }
                                </td>
                                <td>
                                    @{
                                        // Hi·ªÉn th·ªã "C√≤n d∆∞ n·ª£" n·∫øu ƒë√£ giao nh∆∞ng c√≤n n·ª£
                                        if (order.DisplayStatus == "DEBT")
                                        {
                                            <span class="badge" style="background: var(--warning); color: #000; border: 1px solid var(--warning); font-weight: 600;">
                                                C√≤n d∆∞ n·ª£
                                            </span>
                                        }
                                        else
                                        {
                                            @await Html.PartialAsync("_StatusBadge", order.Status)
                                        }
                                    }
                                </td>
                                <td>
                                    <a href="/Dealer/Sales/OrderDetail?id=@order.Id" class="btn btn-primary btn-sm">
                                        <i class="bi bi-eye"></i> Chi ti·∫øt
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-state-icon">üì¶</div>
                <div class="empty-state-title">Ch∆∞a c√≥ ƒë∆°n h√†ng</div>
                <div class="empty-state-text">T·∫°o b√°o gi√° v√† ƒë∆°n h√†ng m·ªõi</div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <style>
        .tab-btn:hover { background: rgba(255,255,255,0.05); }
    </style>
}

