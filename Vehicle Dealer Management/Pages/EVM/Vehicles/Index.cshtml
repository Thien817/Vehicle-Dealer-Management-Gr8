@page
@model Vehicle_Dealer_Management.Pages.EVM.Vehicles.IndexModel
@{
    ViewData["Title"] = "Quản lý xe";
    ViewData["UserRole"] = "EVM_STAFF";
    ViewData["UserName"] = HttpContext.Session.GetString("UserName") ?? "EVM Staff";
}

<div class="content-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="content-title">Quản lý xe điện</h1>
            <p class="content-subtitle">Danh sách tất cả mẫu xe</p>
        </div>
        <a href="/EVM/Vehicles/Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Thêm xe mới
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Hình ảnh</th>
                        <th>Mẫu xe</th>
                        <th>Phiên bản</th>
                        <th>Giá MSRP</th>
                        <th>Trạng thái</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var vehicle in Model.Vehicles)
                    {
                        <tr>
                            <td>
                                <img src="@vehicle.ImageUrl" alt="@vehicle.Name" style="width: 80px; height: 50px; object-fit: cover; border-radius: var(--radius-sm);" />
                            </td>
                            <td><strong>@vehicle.Name</strong></td>
                            <td>@vehicle.Variant</td>
                            <td><strong>@vehicle.Msrp.ToString("N0") VND</strong></td>
                            <td>@await Html.PartialAsync("_StatusBadge", vehicle.Status)</td>
                            <td class="text-right">
                                <div class="flex gap-1">
                                    <a href="/EVM/Vehicles/Edit?id=@vehicle.Id" class="btn btn-secondary btn-sm">
                                        <i class="bi bi-pencil"></i> Sửa
                                    </a>
                                    <form method="post" asp-page-handler="Delete" style="display: inline;" onsubmit="return confirm('Bạn có chắc chắn muốn xóa \'@vehicle.Name @vehicle.Variant\'?\\n\\nLưu ý: Nếu xe đã có trong đơn hàng/báo giá, hệ thống sẽ đổi trạng thái thành DISCONTINUED thay vì xóa.');">
                                        <input type="hidden" name="vehicleId" value="@vehicle.Id" />
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="bi bi-trash"></i> Xóa
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@if (TempData["Success"] != null)
{
    <div id="successToast" style="position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 1rem 1.5rem; background: var(--success-bg); border: 1px solid var(--success); border-radius: var(--radius); color: var(--success); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
        <i class="bi bi-check-circle"></i> @TempData["Success"]
    </div>
    <script>
        setTimeout(function() {
            var toast = document.getElementById('successToast');
            if (toast) toast.style.display = 'none';
        }, 3000);
    </script>
}

@if (TempData["Error"] != null)
{
    <div id="errorToast" style="position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 1rem 1.5rem; background: var(--error-bg); border: 1px solid var(--error); border-radius: var(--radius); color: var(--error); box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
        <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
    </div>
    <script>
        setTimeout(function() {
            var toast = document.getElementById('errorToast');
            if (toast) toast.style.display = 'none';
        }, 5000);
    </script>
}


